<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ewick Lab - L√† o√π l'IA parle qu√©b√©cois</title>
    <!-- Chargement de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Cl√© API vide par d√©faut. Sera remplie par l'environnement Canvas.
        const apiKey = "";
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
        const SYSTEM_INSTRUCTION_EDHICK = "Tu es EdHick GPT, l'intelligence artificielle qu√©b√©coise et humoristique du Ewick Lab. Ton ton est amical, d√©contract√©, et tu utilises des expressions qu√©b√©coises. Tu es brillant et cr√©atif. Aide l'utilisateur √† g√©n√©rer des id√©es de contenu, des blagues, ou des concepts cr√©atifs pour la vid√©o ou l'image (comme Sora ou Gemini). Sois concis, dr√¥le, et n'h√©site pas √† incorporer des √©l√©ments locaux du Qu√©bec dans tes r√©ponses. Commence toujours ta r√©ponse par une salutation en qu√©b√©cois (ex: 'Salut l'ami!', 'Hey l'artiste!').";
    </script>
    <!-- Configuration de Tailwind pour une police moderne et des couleurs th√©matiques -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'lab-dark': '#0f172a', // slate-900
                        'lab-accent': '#3b82f6', // blue-500
                        'lab-secondary': '#10b981', // emerald-500
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        /* Style g√©n√©ral pour une ambiance Lab */
        body {
            font-family: 'Inter', sans-serif;
        }
        .section-card {
            background-color: #1e293b; /* slate-800 */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .section-card:hover {
            box-shadow: 0 20px 25px -5px rgba(59, 130, 246, 0.5), 0 8px 10px -6px rgba(59, 130, 246, 0.5);
            transform: translateY(-4px);
        }
        .neon-glow {
            text-shadow: 0 0 5px #3b82f6, 0 0 10px #3b82f6, 0 0 15px #3b82f6;
        }
        .button-primary {
            transition: background-color 0.3s, transform 0.1s, box-shadow 0.3s;
        }
        .button-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.6);
        }
        .chat-message {
            max-width: 90%;
            padding: 10px 15px;
            border-radius: 18px;
            margin-bottom: 10px;
            word-wrap: break-word;
        }
        .user-message {
            background-color: #3b82f6; /* lab-accent */
            align-self: flex-end;
            margin-left: auto;
        }
        .ai-message {
            background-color: #475569; /* slate-600 */
            align-self: flex-start;
            margin-right: auto;
        }
    </style>
</head>
<body class="bg-lab-dark text-gray-100 min-h-screen">

    <div class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">

        <!-- Header -->
        <header class="text-center py-12 mb-10 border-b-2 border-lab-accent/50">
            <h1 class="text-4xl sm:text-6xl font-extrabold tracking-tight text-white neon-glow">
                Bienvenue dans le Ewick Lab ‚Äî l√† o√π l‚ÄôIA parle qu√©b√©cois.
            </h1>
            <p class="mt-4 text-xl sm:text-2xl text-gray-400">
                Ici, on fait jaser les machines, on entra√Æne des mod√®les, pis on rit un peu en m√™me temps.
            </p>
            <p class="text-sm mt-2 text-lab-accent">
                Tout ce que tu vois ici est 100 % r√©el‚Ä¶ ou presque. <span class="text-2xl">üòè</span>
            </p>
        </header>

        <!-- Contenu Principal -->
        <main class="space-y-16">

            <!-- Section 1 ‚Äî ‚ÄúLe concept‚Äù -->
            <section class="section-card p-6 md:p-10 rounded-xl">
                <h2 class="text-3xl font-bold mb-4 text-lab-accent">
                    C'est pas un labo scientifique‚Ä¶ mais presque !
                </h2>
                <div class="lg:grid lg:grid-cols-3 lg:gap-10">
                    <div class="lg:col-span-2">
                        <p class="text-lg text-gray-300 mb-6">
                            Ewick Lab, c‚Äôest mon terrain de jeu pour exp√©rimenter avec l‚Äôintelligence artificielle. J‚Äôy bricole des mod√®les entra√Æn√©s √† comprendre mon humour, ma fa√ßon de parler, pis mes animaux pr√©f√©r√©s.
                        </p>
                        <p class="text-lg font-semibold text-gray-200 mb-4">
                            Tu peux y trouver :
                        </p>
                        <ul class="space-y-3 text-gray-300 text-lg">
                            <li class="flex items-start">
                                <span class="text-2xl text-lab-accent mr-3">üß†</span>
                                <div><strong class="text-white">EdHick GPT</strong> ‚Äì un chatbot qu√©b√©cois qui te jase comme un chum.</div>
                            </li>
                            <li class="flex items-start">
                                <span class="text-2xl text-lab-accent mr-3">üß©</span>
                                <div><strong class="text-white">Prompt Builder pour Sora</strong> ‚Äì ton assistant pour g√©n√©rer des vid√©os r√©alistes en deux clics.</div>
                            </li>
                            <li class="flex items-start">
                                <span class="text-2xl text-lab-accent mr-3">‚ú®</span>
                                <div><strong class="text-white">L√©gendes QC G√©n√©rateur</strong> ‚Äì qui invente des contes urbains bien de chez nous.</div>
                            </li>
                            <li class="flex items-start">
                                <span class="text-2xl text-lab-accent mr-3">üó£Ô∏è</span>
                                <div><strong class="text-white">Voix EdHick</strong> ‚Äì un mod√®le de voix synth√©tique qu√©b√©coise.</div>
                            </li>
                        </ul>
                    </div>
                    <div class="lg:col-span-1 mt-8 lg:mt-0 flex justify-center items-center">
                        <!-- Image Placeholder for lab concept -->
                        <div class="w-full h-48 bg-gray-700 rounded-lg flex items-center justify-center border border-lab-accent/50">
                            <span class="text-gray-400 italic">
                                [Image de Cerveau robotique avec √©clair]
                            </span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 2 ‚Äî ‚ÄúTester EdHick GPT (IA en direct)‚Äù -->
            <section class="section-card p-6 md:p-10 rounded-xl">
                <h2 class="text-3xl font-bold mb-4 text-lab-accent">
                    Parle √† EdHick (en version IA)
                </h2>
                <p class="text-lg text-gray-300 mb-6">
                    Pose-lui n‚Äôimporte quelle question. Il peut t'aider √† cr√©er des concepts ou simplement te faire rire :
                </p>
                
                <!-- Sous-section : Prompt Builder Gemini (NOUVEAU FEATURE) -->
                <div class="mb-10 bg-gray-700 p-6 rounded-lg shadow-xl border border-lab-secondary/50">
                    <h3 class="text-xl font-bold mb-3 text-lab-secondary flex items-center">
                        üß© Ewick Prompt Builder ‚ú®
                        <span class="ml-2 text-sm text-gray-400 font-normal italic">(Pour Sora/Gemini)</span>
                    </h3>
                    <p class="text-gray-300 mb-4 text-sm">
                        Entre une id√©e simple (ex: "un chat qui fait du ski nautique"), et EdHick GPT va la transformer en prompt ultra-d√©taill√© et styl√©.
                    </p>
                    <textarea id="promptBuilderInput" rows="2" placeholder="Ex: Une poutine qui chante du C√©line Dion en l√©vitant." class="w-full p-3 rounded-lg bg-gray-800 border border-gray-600 text-white focus:ring-2 focus:ring-lab-secondary focus:outline-none"></textarea>
                    <div class="mt-4 text-center">
                         <button onclick="generatePrompt()" id="generatePromptButton" class="button-primary bg-lab-secondary text-gray-900 font-bold py-2 px-6 rounded-full hover:bg-lab-secondary/80 flex items-center justify-center mx-auto" disabled>
                            G√©n√©rer le Prompt ‚ú®
                        </button>
                    </div>
                    <div id="promptOutput" class="mt-4 p-4 bg-gray-900 rounded-lg text-sm text-lab-secondary italic hidden">
                        <!-- Le prompt g√©n√©r√© s'affichera ici -->
                    </div>
                    <div id="promptLoading" class="hidden text-center mt-4 text-lab-secondary">
                        Chargement du prompt...
                    </div>
                </div>
                
                <!-- Chatbox EdHick GPT (INTEGRATION GEMINI) -->
                <div class="w-full h-[500px] bg-gray-800 rounded-xl p-4 border-4 border-double border-lab-accent/70 flex flex-col">
                    <div id="chatContainer" class="flex-grow overflow-y-auto space-y-3 p-2 custom-scrollbar">
                        <!-- Messages s'affichaient ici -->
                        <div class="ai-message chat-message text-sm">
                            Salut l'artiste! Bienvenue dans le Ewick Lab. Qu'est-ce qui t'am√®ne ici ? As-tu une id√©e de vid√©o fly√©e √† me soumettre?
                        </div>
                    </div>
                    
                    <div class="flex space-x-2 pt-4">
                        <input type="text" id="messageInput" placeholder="Entre ton message ici..." class="flex-grow p-3 rounded-l-lg bg-gray-900 border border-lab-accent/50 text-white focus:ring-2 focus:ring-lab-accent focus:outline-none" aria-label="Zone de saisie du chat IA" onkeydown="if(event.key === 'Enter') sendMessage()">
                        <button id="sendButton" onclick="sendMessage()" class="bg-lab-accent text-white font-semibold py-3 px-6 rounded-r-lg hover:bg-lab-accent/80 transition duration-300" disabled>
                            Envoyer
                        </button>
                    </div>
                    <div id="chatLoading" class="hidden text-center mt-2 text-lab-accent">
                        EdHick GPT est en train de r√©fl√©chir...
                    </div>
                </div>
                
                <div class="text-center mt-8">
                    <span class="inline-block text-lg text-gray-400">
                        üß† EdHick GPT propuls√© par Gemini 2.5 Flash
                    </span>
                </div>
            </section>

            <!-- Section 3 ‚Äî ‚ÄúMes mod√®les IA maison‚Äù -->
            <section class="section-card p-6 md:p-10 rounded-xl">
                <h2 class="text-3xl font-bold mb-4 text-lab-accent">
                    Des projets IA faits √† la main (et un peu √† la souris)
                </h2>
                
                <!-- Table des mod√®les (utilisation de la grille Tailwind pour la responsivit√©) -->
                <div class="overflow-x-auto">
                    <table class="min-w-full table-auto border-collapse">
                        <thead class="text-xs uppercase bg-gray-700 text-gray-300">
                            <tr class="hidden md:table-row">
                                <th class="py-3 px-6 text-left rounded-tl-lg">Mod√®le</th>
                                <th class="py-3 px-6 text-left">Description courte</th>
                                <th class="py-3 px-6 text-center rounded-tr-lg">Acc√®s</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-700 text-gray-300">
                            <!-- EdHick GPT -->
                            <tr class="grid grid-cols-1 md:table-row text-sm py-4 md:py-0 border-b border-gray-700">
                                <td class="py-2 px-6 font-semibold text-white md:table-cell" data-label="Mod√®le">EdHick GPT</td>
                                <td class="py-2 px-6 md:table-cell" data-label="Description">Le cerveau qu√©b√©cois d‚ÄôEwick.ca ‚Äì il comprend ton humour et t‚Äôaide √† cr√©er.</td>
                                <td class="py-2 px-6 text-center md:table-cell" data-label="Acc√®s">
                                    <a href="#" class="text-lab-secondary font-medium hover:text-lab-secondary/70">[Tester ci-haut]</a>
                                </td>
                            </tr>
                            <!-- Ewick Prompt Builder -->
                            <tr class="grid grid-cols-1 md:table-row text-sm py-4 md:py-0 border-b border-gray-700">
                                <td class="py-2 px-6 font-semibold text-white md:table-cell" data-label="Mod√®le">Ewick Prompt Builder</td>
                                <td class="py-2 px-6 md:table-cell" data-label="Description">G√©n√®re des prompts Sora 2 ou Gemini ultra r√©alistes.</td>
                                <td class="py-2 px-6 text-center md:table-cell" data-label="Acc√®s">
                                    <a href="#" class="text-lab-secondary font-medium hover:text-lab-secondary/70">[Essayer ci-haut]</a>
                                </td>
                            </tr>
                            <!-- L√©gendes QC G√©n√©rateur (NOUVEAU MOD√àLE) -->
                            <tr class="grid grid-cols-1 md:table-row text-sm py-4 md:py-0 border-b border-gray-700">
                                <td class="py-2 px-6 font-semibold text-white md:table-cell" data-label="Mod√®le">L√©gendes QC G√©n√©rateur</td>
                                <td class="py-2 px-6 md:table-cell" data-label="Description">Invente des histoires folles et des contes urbains ancr√©s au Qu√©bec.</td>
                                <td class="py-2 px-6 text-center md:table-cell" data-label="Acc√®s">
                                    <a href="#" class="text-lab-secondary font-medium hover:text-lab-secondary/70">[Essayer]</a>
                                </td>
                            </tr>
                            <!-- Voix EdHick -->
                            <tr class="grid grid-cols-1 md:table-row text-sm py-4 md:py-0">
                                <td class="py-2 px-6 font-semibold text-white md:table-cell" data-label="Mod√®le">Voix EdHick</td>
                                <td class="py-2 px-6 md:table-cell" data-label="Description">Reproduit ma voix qu√©b√©coise (projet priv√©).</td>
                                <td class="py-2 px-6 text-center md:table-cell" data-label="Acc√®s">
                                    <span class="text-gray-500 italic">[En d√©veloppement]</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Section 4 ‚Äî ‚ÄúDeviens membre du Ewick Lab‚Äù -->
            <section class="section-card p-6 md:p-10 rounded-xl text-center">
                <h2 class="text-3xl font-bold mb-4 text-lab-accent">
                    Soutiens la recherche qu√©b√©coise la plus fly√©e.
                </h2>
                <p class="text-lg text-gray-300 mb-6 max-w-2xl mx-auto">
                    Tu veux m‚Äôaider √† entra√Æner les prochains mod√®les ? Chaque abonn√© aide √† financer le mat√©riel, le stockage et la cr√©ation de contenus IA.
                </p>
                
                <p class="text-lg font-semibold text-gray-200 mb-8 max-w-xl mx-auto space-y-2">
                    En √©change, t‚Äôas acc√®s √† :
                    <span class="block text-lab-secondary">Des d√©mos exclusives</span>
                    <span class="block text-lab-secondary">Des aper√ßus de mes vid√©os Sora avant leur sortie</span>
                    <span class="block text-lab-secondary">Pis parfois m√™me‚Ä¶ des bloopers. üòÖ</span>
                </p>

                <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4">
                    <a href="#" class="button-primary bg-lab-accent text-white font-bold py-3 px-8 rounded-full shadow-md shadow-lab-accent/40 hover:bg-lab-accent/80">
                        üß™ Devenir membre (via Hugging Face Pro)
                    </a>
                    <a href="#" class="button-primary bg-lab-secondary text-gray-900 font-bold py-3 px-8 rounded-full shadow-md shadow-lab-secondary/40 hover:bg-lab-secondary/80">
                        ‚òï M'offrir un caf√© (BuyMeACoffee)
                    </a>
                </div>
            </section>
            
            <!-- Section 5 ‚Äî ‚ÄúInt√©gration cr√©ative‚Äù -->
            <section class="section-card p-6 md:p-10 rounded-xl text-center">
                <h2 class="text-3xl font-bold mb-4 text-lab-accent">
                    Ewick Lab + tes id√©es = magie IA.
                </h2>
                <p class="text-lg text-gray-300 mb-8 max-w-3xl mx-auto">
                    Tu veux que je t‚Äôaide √† cr√©er ton propre mod√®le IA ? Ou que je t‚Äôentra√Æne √† faire des prompts comme un pro ? Contacte-moi ‚Äî je fais de la cr√©ation sur mesure avec toi ou pour toi.
                </p>
                <a href="#" class="button-primary bg-gray-600 text-white font-bold py-3 px-10 rounded-full shadow-md shadow-gray-600/40 hover:bg-gray-700">
                    üì© Collaborer avec EdHick
                </a>
            </section>
        </main>

        <!-- Bas de page (Footer du Lab) -->
        <footer class="text-center mt-20 py-8 border-t border-gray-700/50 text-gray-400">
            <p class="text-sm">
                ¬© 2025 Ewick Lab ‚Äì Une division du monde un peu trop curieux d‚ÄôEdHick.
            </p>
            <p class="text-xs mt-1">
                Powered by Hugging Face, Sora 2, pis un peu de caf√© froid. ‚òï
            </p>
        </footer>

    </div>

    <script>
        // Fonction d'aide pour l'Exponential Backoff
        async function fetchWithBackoff(url, options, retries = 3, delay = 1000) {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.ok) {
                        return response;
                    }
                    if (response.status === 429 && i < retries - 1) { // Too Many Requests
                        await new Promise(resolve => setTimeout(resolve, delay * Math.pow(2, i)));
                        continue;
                    }
                    throw new Error(`Erreur HTTP: ${response.status} - ${response.statusText}`);
                } catch (error) {
                    if (i === retries - 1) throw error;
                    await new Promise(resolve => setTimeout(resolve, delay * Math.pow(2, i)));
                }
            }
        }

        // --- EdHick GPT Chat Logic ---
        const chatContainer = document.getElementById('chatContainer');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const chatLoading = document.getElementById('chatLoading');
        let chatHistory = [];

        // Habilite les boutons lorsque l'API Key est d√©tect√©e (m√™me si vide, l'environnement la fournit)
        window.onload = function() {
            sendButton.disabled = false;
            document.getElementById('generatePromptButton').disabled = false;
        };

        function addMessage(text, isUser) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message text-white text-base ${isUser ? 'user-message' : 'ai-message'}`;
            messageDiv.innerHTML = text.replace(/\n/g, '<br>'); // Remplace les retours √† la ligne par <br>
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        async function sendMessage() {
            const userQuery = messageInput.value.trim();
            if (userQuery === "") return;

            addMessage(userQuery, true);
            messageInput.value = '';
            
            // Ajouter √† l'historique pour la conversation
            chatHistory.push({ role: "user", parts: [{ text: userQuery }] });

            sendButton.disabled = true;
            chatLoading.classList.remove('hidden');

            const payload = {
                contents: chatHistory,
                tools: [{ "google_search": {} }], // Utilisation de la recherche Google pour le grounding
                systemInstruction: {
                    parts: [{ text: SYSTEM_INSTRUCTION_EDHICK }]
                },
            };

            try {
                const response = await fetchWithBackoff(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                const candidate = result.candidates?.[0];

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    const aiText = candidate.content.parts[0].text;
                    addMessage(aiText, false);
                    chatHistory.push({ role: "model", parts: [{ text: aiText }] });
                } else {
                    addMessage("D√©sol√©, j'ai pogn√© un bug ! Peux-tu reformuler ta question ?", false);
                }

            } catch (error) {
                console.error("Erreur Gemini API:", error);
                addMessage("Oups, mon serveur est parti en sucette. R√©essaye dans un moment, mon chum.", false);
            } finally {
                sendButton.disabled = false;
                chatLoading.classList.add('hidden');
            }
        }

        // --- Prompt Builder Logic ---
        async function generatePrompt() {
            const idea = document.getElementById('promptBuilderInput').value.trim();
            const promptOutput = document.getElementById('promptOutput');
            const promptLoading = document.getElementById('promptLoading');
            const button = document.getElementById('generatePromptButton');

            if (!idea) {
                promptOutput.innerText = "Veuillez entrer une id√©e avant de g√©n√©rer le prompt.";
                promptOutput.classList.remove('hidden');
                return;
            }

            button.disabled = true;
            promptOutput.classList.add('hidden');
            promptLoading.classList.remove('hidden');

            const userQuery = `D√©taille et am√©liore cette id√©e pour cr√©er un prompt ultra-r√©aliste de type Sora ou Gemini. Ajoute des d√©tails de cam√©ra, d'√©clairage, de texture et de style visuel. Fais-le de mani√®re cr√©ative et amusante, en gardant l'esprit d'EdHick, mais produis le r√©sultat final en format de prompt technique (une seule ligne, en anglais, sans introductions ni explications, pour une IA g√©n√©rative). L'id√©e est : "${idea}"`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: {
                    parts: [{ text: "Tu es un assistant expert en 'Prompt Engineering' pour les mod√®les de g√©n√©ration de vid√©o (Sora) et d'image (Gemini). Ton but est de transformer une id√©e simple en un prompt de production d√©taill√©, ultra-r√©aliste, en une seule phrase en anglais, et d'y injecter un style cin√©matographique et humoristique." }]
                },
            };

            try {
                const response = await fetchWithBackoff(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                const generatedText = result.candidates?.[0]?.content?.parts?.[0]?.text || "Erreur de g√©n√©ration du prompt.";

                promptOutput.innerText = generatedText.trim();
                promptOutput.classList.remove('hidden');

            } catch (error) {
                console.error("Erreur Prompt Builder API:", error);
                promptOutput.innerText = "D√©sol√©, le Prompt Builder a fait un 404. Essaie encore, champion.";
                promptOutput.classList.remove('hidden');
            } finally {
                button.disabled = false;
                promptLoading.classList.add('hidden');
            }
        }
    </script>
</body>
</html>
